{% from "sensu/map.jinja" import sensu with context %}
{

{%- if salt['pillar.get']('sensu:hipchat_apikey', False) %}
  "hipchat": {
    "apikey": "{{ sensu.hipchat_apikey }}",
    "apiversion": "v2",
    "room": "{{ sensu.hipchat_roomname }}"
  },
{%- endif %}
 
{%- if salt['pillar.get']('sensu:pagerduty_apikey', False) %}
  "pagerduty": {
    "api_key": "{{ sensu.pagerduty_apikey }}"
  },
{%- endif %}
 
  "handlers": {
    "default": {
      "type": "set",
      "handlers": [
{%- if salt['pillar.get']('sensu:hipchat_apikey', False) %}
        "hipchat",
{%- endif %}
{%- if salt['pillar.get']('sensu:pagerduty_apikey', False) %}
        "pagerduty",
{%- endif %}
{%- if salt['pillar.get']('sensu:email', False) %}
        "email",
{%- endif %}
        "stdout"
      ]
    },
{%- if salt['pillar.get']('sensu:pagerduty_apikey', False) %}
    "pagerduty": {
      "command": "/etc/sensu/community/handlers/notification/pagerduty.rb",
      "type": "pipe"
    },
{%- endif %}
{%- if salt['pillar.get']('sensu:hipchat_apikey', False) %}
    "hipchat": {
      "command": "/etc/sensu/community/handlers/notification/hipchat.rb",
      "type": "pipe"
    },
{%- endif %}
{%- if salt['pillar.get']('sensu:email', False) %}
    "email": {
      "type": "pipe",
      "command": "mail -s '[sensu] alert' {{sensu.email}}"
    },
{%- endif %}
    "stdout": {
      "type": "pipe",
      "command": "cat"
    }
  }
}

